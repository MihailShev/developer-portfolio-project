{"version":3,"file":"chat-ai.js","sources":["../src/js/chat-ai.js"],"sourcesContent":["import { requesr, answer } from './render-function.js';\nimport axios from 'axios';\nconst chat = document.querySelector('.message-container');\nconst inp = document.querySelector('.js-user-message-inp');\nconst divElBtnForm = document.querySelector('.inner-form-svg');\nconst sendBtn = document.querySelector('.js-user-send-btn');\nconst loaderChat = document.querySelector('.loader-chat-wrap');\n\nconst loader = document.querySelector('.loader-container-site');\n\nconst viewLoader = () => {\n  loader.style.display = 'block';\n};\n\nconst hideLoader = () => {\n  loader.style.display = 'none';\n};\n\nwindow.addEventListener('load', () => {\n  hideLoader();\n});\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  viewLoader();\n});\n\nconst hideLoaderChat = () => {\n  loaderChat.style.display = 'none';\n};\n\nconst viewLoaderChat = () => {\n  loaderChat.style.display = 'block';\n};\nlet speechSynthesisInstance = window.speechSynthesis;\nlet textToTalk = null;\n\n// stop speech\nconst stopSpeechOnUnload = () => {\n  if (speechSynthesisInstance.speaking || speechSynthesisInstance.pending) {\n    speechSynthesisInstance.cancel();\n  }\n};\n\n// men or girl speech\nconst getPreferredVoice = () => {\n  const voices = speechSynthesisInstance.getVoices();\n  return voices[1] || voices[0];\n};\n\n// await speech\nspeechSynthesisInstance.onvoiceschanged = () => {\n  console.log('Доступные голоса:', speechSynthesisInstance.getVoices());\n};\n\n// talkMessage\nconst talkMessage = text => {\n  if (speechSynthesisInstance.speaking || speechSynthesisInstance.pending) {\n    speechSynthesisInstance.cancel();\n  }\n\n  textToTalk = new SpeechSynthesisUtterance(text);\n  textToTalk.voice = getPreferredVoice();\n\n  speechSynthesisInstance.speak(textToTalk);\n};\n\n// copy\nconst copyToText = async text => {\n  try {\n    await navigator.clipboard.writeText(text);\n  } catch (err) {\n    console.log(err);\n  }\n};\n\n// stop speech\nwindow.addEventListener('beforeunload', stopSpeechOnUnload);\nwindow.addEventListener('visibilitychange', () => {\n  if (document.hidden) stopSpeechOnUnload();\n});\n\n// Value Prompt\nlet userMessageInput = '';\n\n// Inp Value And \"btn:disabled\"\nconst buttonState = () => (sendBtn.disabled = inp.value.trim() === '');\ninp.addEventListener('input', () => {\n  userMessageInput = inp.value.trim();\n  buttonState();\n  return userMessageInput;\n});\n\n// Btn Send And Talk\nconst handlerBtnSendTalk = e => {\n  e.preventDefault();\n\n  const btn = e.target.closest('button');\n  if (!btn) return;\n\n  // Btn Send\n  if (btn.classList.contains('js-user-send-btn')) {\n    if (userMessageInput !== '') {\n      chat.insertAdjacentHTML('beforeend', requesr(userMessageInput));\n      chat.scrollTop = chat.scrollHeight;\n      sendMessageToChatGPT(userMessageInput);\n      inp.value = '';\n      userMessageInput = '';\n      buttonState();\n    }\n  }\n\n  // Btn Talk\n  if (btn.classList.contains('js-user-talt-btn')) {\n    startSpeechRecognition();\n  }\n};\ndivElBtnForm.addEventListener('click', handlerBtnSendTalk);\n\n// **Обработчик кликов для кнопок \"Говорить\" и \"Копировать\"**\nconst talkCopyEvent = e => {\n  const btn = e.target.closest('button');\n  if (!btn) return;\n\n  const messageElement = btn\n    .closest('.message-ai')\n    ?.querySelector('.message-text');\n  if (!messageElement) return;\n\n  const messageText = messageElement.textContent.trim();\n\n  if (btn.classList.contains('btn-speech')) {\n    talkMessage(messageText);\n  }\n\n  if (btn.classList.contains('btn-copy')) {\n    copyToText(messageText);\n  }\n};\n\n// Навешиваем обработчик событий на чат\nchat.addEventListener('click', talkCopyEvent);\n\n// Setting Spech Lang\nconst SpeechRecognition =\n  window.SpeechRecognition || window.webkitSpeechRecognition;\nconst speechRecognizer = new SpeechRecognition();\nspeechRecognizer.interimResults = false;\n// Lang Set It Up For Yourself\nspeechRecognizer.lang = 'en';\n\n// Start Talk\nconst startSpeechRecognition = () => speechRecognizer.start();\n\n// Add Chat Message Talk\nspeechRecognizer.onresult = e => {\n  const recognizedText = e.results[0][0].transcript;\n  chat.insertAdjacentHTML('beforeend', requesr(recognizedText));\n  chat.scrollTop = chat.scrollHeight;\n  sendMessageToChatGPT(recognizedText);\n};\n\n// Request API\nconst sendMessageToChatGPT = async userMessage => {\n  try {\n    viewLoaderChat();\n    const res = await axios.post(\n      `${import.meta.env.VITE_URL_FETCH_API}`,\n      {\n        model: 'mistralai/Mistral-7B-Instruct-v0.1',\n        messages: [{ role: 'user', content: userMessage }],\n      },\n      {\n        headers: {\n          Authorization: `Bearer ${import.meta.env.VITE_KEY_API}`,\n          'Content-Type': 'application/json',\n        },\n      }\n    );\n\n    chat.insertAdjacentHTML(\n      'beforeend',\n      answer(res.data.choices[0].message.content)\n    );\n    chat.scrollTop = chat.scrollHeight;\n\n    return;\n  } catch (err) {\n    console.error(err.response ? err.response.data : err.message);\n  } finally {\n    hideLoaderChat();\n  }\n};\n"],"names":["chat","inp","divElBtnForm","sendBtn","loaderChat","loader","viewLoader","hideLoader","hideLoaderChat","viewLoaderChat","speechSynthesisInstance","textToTalk","stopSpeechOnUnload","getPreferredVoice","voices","talkMessage","text","copyToText","err","userMessageInput","buttonState","handlerBtnSendTalk","e","btn","requesr","sendMessageToChatGPT","startSpeechRecognition","talkCopyEvent","messageElement","_a","messageText","SpeechRecognition","speechRecognizer","recognizedText","userMessage","res","axios","answer"],"mappings":"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"}